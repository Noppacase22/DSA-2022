def find_path(map, current_path, current_nodes, shortest_path, shortest_nodes, previous_node, current_set):
    for i in range(len(map)):
        if i in current_set:
            continue
        temp = current_path + map[current_nodes[-1]][i]
        if temp + map[i][0] >= shortest_path:
            break   # Changing continue into break cut the time in almost half! I have no idea why it would work...
        new_nodes = current_nodes.copy()
        new_nodes.append(i)
        if len(new_nodes) == len(map):
            shortest_path = temp + map[i][0]
            shortest_nodes = new_nodes
        else:
            new_set = current_set.copy()
            new_set.add(i)
            [shortest_nodes, shortest_path] = find_path(map, temp, new_nodes, shortest_path, shortest_nodes, previous_node, new_set)
    return [shortest_nodes, shortest_path]

def salesman(city_map):    
    s = set()
    s.add(0)
    path = find_path(city_map, 0, [0], float("inf"), [0], 0, s)
    path[0].append(0)
    return path[0]

if __name__ == "__main__":

    import time
    
    map1 = [[0, 171, 290, 172, 134, 101, 180, 183, 177, 195],
        [171, 0, 192, 272, 216, 160, 270, 228, 255, 253],
        [290, 192, 0, 167, 296, 134, 240, 140, 268, 138],
        [172, 272, 167, 0, 161, 149, 215, 157, 118, 128],
        [134, 216, 296, 161, 0, 177, 211, 205, 236, 298],
        [101, 160, 134, 149, 177, 0, 220, 161, 120, 297],
        [180, 270, 240, 215, 211, 220, 0, 109, 138, 124],
        [183, 228, 140, 157, 205, 161, 109, 0, 198, 213],
        [177, 255, 268, 118, 236, 120, 138, 198, 0, 142],
        [195, 253, 138, 128, 298, 297, 124, 213, 142, 0]]
    
    map2 = [[0, 258, 266, 157, 167, 288, 225, 237, 109, 127],
        [258, 0, 144, 101, 214, 234, 272, 199, 100, 255],
        [266, 144, 0, 239, 203, 169, 218, 225, 212, 216],
        [157, 101, 239, 0, 249, 233, 202, 279, 237, 224],
        [167, 214, 203, 249, 0, 223, 134, 142, 116, 135],
        [288, 234, 169, 233, 223, 0, 207, 243, 112, 217],
        [225, 272, 218, 202, 134, 207, 0, 212, 189, 211],
        [237, 199, 225, 279, 142, 243, 212, 0, 123, 298],
        [109, 100, 212, 237, 116, 112, 189, 123, 0, 228],
        [127, 255, 216, 224, 135, 217, 211, 298, 228, 0]]
    
    map3 = [[0, 233, 150, 211, 127, 149, 275, 214, 260, 266],
        [233, 0, 264, 163, 173, 189, 178, 270, 300, 151],
        [150, 264, 0, 283, 141, 146, 218, 290, 260, 117],
        [211, 163, 283, 0, 271, 120, 290, 242, 101, 297],
        [127, 173, 141, 271, 0, 251, 292, 153, 153, 208],
        [149, 189, 146, 120, 251, 0, 277, 168, 208, 122],
        [275, 178, 218, 290, 292, 277, 0, 252, 256, 114],
        [214, 270, 290, 242, 153, 168, 252, 0, 204, 189],
        [260, 300, 260, 101, 153, 208, 256, 204, 0, 165],
        [266, 151, 117, 297, 208, 122, 114, 189, 165, 0]]
    
    map4 = [[0, 277, 187, 121, 206, 183, 255, 245, 104, 297],
        [277, 0, 189, 276, 284, 266, 147, 290, 200, 183],
        [187, 189, 0, 238, 244, 182, 161, 118, 151, 112],
        [121, 276, 238, 0, 116, 118, 143, 207, 186, 268],
        [206, 284, 244, 116, 0, 289, 178, 149, 247, 277],
        [183, 266, 182, 118, 289, 0, 124, 245, 148, 248],
        [255, 147, 161, 143, 178, 124, 0, 246, 233, 112],
        [245, 290, 118, 207, 149, 245, 246, 0, 244, 109],
        [104, 200, 151, 186, 247, 148, 233, 244, 0, 244],
        [297, 183, 112, 268, 277, 248, 112, 109, 244, 0]]
    
    map5 = [[0, 255, 201, 256, 243, 110, 196, 145, 253, 143],
        [255, 0, 212, 215, 231, 147, 112, 125, 295, 203],
        [201, 212, 0, 284, 217, 263, 254, 262, 209, 292],
        [256, 215, 284, 0, 199, 262, 113, 244, 119, 219],
        [243, 231, 217, 199, 0, 148, 142, 192, 188, 298],
        [110, 147, 263, 262, 148, 0, 179, 147, 294, 184],
        [196, 112, 254, 113, 142, 179, 0, 177, 149, 109],
        [145, 125, 262, 244, 192, 147, 177, 0, 225, 144],
        [253, 295, 209, 119, 188, 294, 149, 225, 0, 145],
        [143, 203, 292, 219, 298, 184, 109, 144, 145, 0]]
    
    start = time.time()
    s1 = salesman(map1)    
    s2 = salesman(map2)
    s3 = salesman(map3)
    s4 = salesman(map4)
    s5 = salesman(map5)
    end = time.time()
    print("\n" + str(round(end - start, 3)) + " Seconds")

    a = 0
    for i in range(len(map1)):
        a += map1[s1[i]][s1[i+1]]
    print(a)    #1381
    print()

    
    city_map = [
    #     0   1   2   3   4
        [ 0, 12, 19, 16, 29],   # 0
        [12,  0, 27, 25,  5],   # 1
        [19, 27,  0,  8,  4],   # 2
        [16, 25,  8,  0, 14],   # 3
        [29,  5,  4, 14,  0]    # 4
        ]
    #start = time.time()
    path = salesman(city_map)
    #print(time.time() - start)
    cost = 0
    for i in range(len(city_map)):
        cost += city_map[path[i]][path[i+1]]
    
    if path != [0, 1, 4, 2, 3, 0]:
        print("ERROR IN PATH!")
        print(path)     # [0, 1, 4, 2, 3, 0]
        print(cost)     # 45